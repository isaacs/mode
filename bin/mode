#!/usr/bin/env node --
var path = require('path')
   ,fs = require('fs')
   ,sys = require('sys')
exports.basedir = path.dirname(__dirname);
require.paths.unshift(path.join(exports.basedir, 'lib'));
var git = require('git')
   ,cli = require('cli')

// set GIT_DIR to our basedir
git.dir = exports.basedir;

var program = new cli.Program([
  'Usage: mode [global options] <command> [command options]',
  'Global options:',
	['quiet',    'Suppress all messages except errors.'],
	['verbose',  'Print details.'],
	['help',  'Show this help message.'],
]);

program.cmd.version = {
  main: function(){
    var self = this;
    git.describe(function(err, stdout, stderr) {
      if (err) self.exit(err);
      self.exit('mode '+stdout.trim());
    });
  },
  desc: 'Print version of mode and exit'
}

program.cmd.update = {
  main: function() {
    git.exec("pull origin master", function(err, stdout, stderr) {
      if (err) self.exit(err);
      self.exit(stdout.trim());
    });
  },
  desc: 'Update the module index.'
}

program.main()
